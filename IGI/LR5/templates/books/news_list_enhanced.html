{% extends 'base_enhanced.html' %}
{% load static %}

{% block title %}News & Articles - HeavyShop{% endblock %}

{% block meta_description %}
Stay informed with the latest news from HeavyShop. Read articles about books, authors, literary events, company updates, and industry insights.
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Blog",
    "name": "HeavyShop News & Articles",
    "description": "Latest news, articles, and updates from HeavyShop bookstore",
    "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'books:news_list' %}",
    "publisher": {
        "@type": "Organization",
        "name": "HeavyShop",
        "url": "{{ request.scheme }}://{{ request.get_host }}"
    },
    "blogPost": [
        {% for article in articles %}
        {
            "@type": "BlogPosting",
            "headline": "{{ article.title|escape }}",
            "description": "{{ article.summary|escape }}",
            "url": "{{ request.scheme }}://{{ request.get_host }}{{ article.get_absolute_url }}",
            "datePublished": "{{ article.published_at|date:'c' }}",
            "dateModified": "{{ article.updated_at|date:'c' }}",
            "author": {
                "@type": "Person",
                "name": "{{ article.author|default:'HeavyShop Team' }}"
            }
            {% if article.image %}
            ,
            "image": "{{ request.scheme }}://{{ request.get_host }}{{ article.image.url }}"
            {% endif %}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<nav aria-label="Breadcrumb">
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'books:home' %}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">News & Articles</li>
    </ol>
</nav>

<div class="row">
    <!-- Main Content -->
    <main class="col-lg-8">
        <section aria-labelledby="news-heading">
            <header class="mb-4">
                <h1 id="news-heading" class="display-6 mb-3">
                    <i class="bi bi-newspaper text-primary"></i>
                    News & Articles
                </h1>
                
                <p class="lead">
                    Stay updated with the latest news from HeavyShop, book reviews, 
                    author interviews, and literary events.
                </p>
                
                <!-- Article Statistics -->
                <div class="article-stats d-flex gap-4 text-muted small">
                    <span>
                        <i class="bi bi-file-text me-1"></i>
                        <strong>{{ articles.paginator.count }}</strong> articles
                    </span>
                    <span>
                        <i class="bi bi-calendar3 me-1"></i>
                        Updated <time datetime="{{ latest_update|date:'c' }}">{{ latest_update|date:"M j, Y" }}</time>
                    </span>
                    <span>
                        <i class="bi bi-eye me-1"></i>
                        <strong id="total-views">{{ total_views|default:0 }}</strong> total views
                    </span>
                </div>
            </header>
            
            <!-- Filter and Search Bar -->
            <section class="filter-section mb-4" aria-labelledby="filter-heading">
                <div class="card">
                    <div class="card-body">
                        <h2 id="filter-heading" class="h6 mb-3">
                            <i class="bi bi-funnel text-secondary"></i>
                            Filter & Search Articles
                        </h2>
                        
                        <form method="get" class="row g-3" novalidate>
                            <div class="col-md-6">
                                <label for="search" class="form-label">Search Articles</label>
                                <div class="input-group">
                                    <input type="search" 
                                           class="form-control" 
                                           id="search"
                                           name="search"
                                           value="{{ request.GET.search }}"
                                           placeholder="Search by title, content, or author..."
                                           aria-describedby="search-help">
                                    <button type="submit" class="btn btn-outline-secondary">
                                        <i class="bi bi-search"></i>
                                        <span class="visually-hidden">Search</span>
                                    </button>
                                </div>
                                <div id="search-help" class="form-text">
                                    Search articles by keywords, title, or author name
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="">All Categories</option>
                                    <option value="news" {% if request.GET.category == 'news' %}selected{% endif %}>Company News</option>
                                    <option value="reviews" {% if request.GET.category == 'reviews' %}selected{% endif %}>Book Reviews</option>
                                    <option value="interviews" {% if request.GET.category == 'interviews' %}selected{% endif %}>Author Interviews</option>
                                    <option value="events" {% if request.GET.category == 'events' %}selected{% endif %}>Literary Events</option>
                                    <option value="tips" {% if request.GET.category == 'tips' %}selected{% endif %}>Reading Tips</option>
                                </select>
                            </div>
                            
                            <div class="col-md-3">
                                <label for="sort" class="form-label">Sort By</label>
                                <select class="form-select" id="sort" name="sort">
                                    <option value="-published_at" {% if request.GET.sort == '-published_at' %}selected{% endif %}>Newest First</option>
                                    <option value="published_at" {% if request.GET.sort == 'published_at' %}selected{% endif %}>Oldest First</option>
                                    <option value="title" {% if request.GET.sort == 'title' %}selected{% endif %}>Title A-Z</option>
                                    <option value="-title" {% if request.GET.sort == '-title' %}selected{% endif %}>Title Z-A</option>
                                    <option value="-views" {% if request.GET.sort == '-views' %}selected{% endif %}>Most Popular</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
            
            <!-- Articles List -->
            {% if articles %}
                <div class="articles-list">
                    {% for article in articles %}
                        <article class="article-card card mb-4" 
                                 itemscope 
                                 itemtype="http://schema.org/BlogPosting">
                            <div class="row g-0">
                                <!-- Article Image -->
                                {% if article.image %}
                                    <div class="col-md-4">
                                        <figure class="article-image-container">
                                            <img src="{{ article.image.url }}" 
                                                 alt="Article image for {{ article.title }}"
                                                 class="img-fluid rounded-start h-100"
                                                 style="object-fit: cover; min-height: 200px;"
                                                 itemprop="image"
                                                 loading="lazy">
                                        </figure>
                                    </div>
                                {% endif %}
                                
                                <!-- Article Content -->
                                <div class="col-md-{% if article.image %}8{% else %}12{% endif %}">
                                    <div class="card-body">
                                        <!-- Article Meta -->
                                        <div class="article-meta d-flex flex-wrap gap-3 mb-2 text-muted small">
                                            <span class="category">
                                                <i class="bi bi-tag me-1"></i>
                                                <span class="badge bg-secondary">{{ article.category|default:"General" }}</span>
                                            </span>
                                            
                                            <span class="publish-date">
                                                <i class="bi bi-calendar3 me-1"></i>
                                                <time datetime="{{ article.published_at|date:'c' }}" 
                                                      itemprop="datePublished">
                                                    {{ article.published_at|date:"F j, Y" }}
                                                </time>
                                            </span>
                                            
                                            {% if article.author %}
                                                <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
                                                    <i class="bi bi-person me-1"></i>
                                                    <span itemprop="name">{{ article.author }}</span>
                                                </span>
                                            {% endif %}
                                            
                                            <span class="reading-time">
                                                <i class="bi bi-clock me-1"></i>
                                                {{ article.reading_time|default:"5" }} min read
                                            </span>
                                            
                                            {% if article.view_count %}
                                                <span class="views">
                                                    <i class="bi bi-eye me-1"></i>
                                                    {{ article.view_count }} views
                                                </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Article Title -->
                                        <header>
                                            <h2 class="card-title h4" itemprop="headline">
                                                <a href="{{ article.get_absolute_url }}" 
                                                   class="text-decoration-none stretched-link">
                                                    {{ article.title }}
                                                </a>
                                            </h2>
                                        </header>
                                        
                                        <!-- Article Summary -->
                                        <div class="article-summary" itemprop="description">
                                            <p class="card-text">
                                                {{ article.summary|default:article.content|truncatechars:200 }}
                                            </p>
                                        </div>
                                        
                                        <!-- Article Tags -->
                                        {% if article.tags %}
                                            <div class="article-tags mt-3">
                                                <span class="small text-muted">Tags:</span>
                                                {% for tag in article.tags %}
                                                    <span class="badge bg-light text-dark me-1">
                                                        <i class="bi bi-hash"></i>{{ tag }}
                                                    </span>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Additional Meta Information -->
                                        <div class="article-actions mt-3 d-flex justify-content-between align-items-center">
                                            <div class="engagement-stats">
                                                {% if article.comments_count %}
                                                    <small class="text-muted me-3">
                                                        <i class="bi bi-chat me-1"></i>
                                                        {{ article.comments_count }} comment{{ article.comments_count|pluralize }}
                                                    </small>
                                                {% endif %}
                                                
                                                {% if article.likes_count %}
                                                    <small class="text-muted me-3">
                                                        <i class="bi bi-heart me-1"></i>
                                                        {{ article.likes_count }} like{{ article.likes_count|pluralize }}
                                                    </small>
                                                {% endif %}
                                            </div>
                                            
                                            <div class="share-buttons">
                                                <button type="button" 
                                                        class="btn btn-sm btn-outline-primary share-btn"
                                                        data-url="{{ request.scheme }}://{{ request.get_host }}{{ article.get_absolute_url }}"
                                                        data-title="{{ article.title }}"
                                                        title="Share this article">
                                                    <i class="bi bi-share"></i>
                                                </button>
                                                
                                                <button type="button" 
                                                        class="btn btn-sm btn-outline-secondary bookmark-btn"
                                                        data-article-id="{{ article.id }}"
                                                        title="Bookmark this article">
                                                    <i class="bi bi-bookmark"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Schema.org metadata -->
                                        <meta itemprop="dateModified" content="{{ article.updated_at|date:'c' }}">
                                        <span itemprop="publisher" itemscope itemtype="http://schema.org/Organization" style="display: none;">
                                            <span itemprop="name">HeavyShop</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if articles.has_other_pages %}
                    <nav aria-label="Articles pagination" class="mt-5">
                        <ul class="pagination justify-content-center">
                            {% if articles.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" 
                                       href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.sort %}sort={{ request.GET.sort }}&{% endif %}page={{ articles.previous_page_number }}"
                                       rel="prev">
                                        <i class="bi bi-chevron-left"></i> Previous
                                    </a>
                                </li>
                            {% endif %}
                            
                            {% for num in articles.paginator.page_range %}
                                {% if num == articles.number %}
                                    <li class="page-item active" aria-current="page">
                                        <span class="page-link">{{ num }}</span>
                                    </li>
                                {% elif num > articles.number|add:'-3' and num < articles.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" 
                                           href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.sort %}sort={{ request.GET.sort }}&{% endif %}page={{ num }}">
                                            {{ num }}
                                        </a>
                                    </li>
                                {% elif num == 1 or num == articles.paginator.num_pages %}
                                    <li class="page-item">
                                        <a class="page-link" 
                                           href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.sort %}sort={{ request.GET.sort }}&{% endif %}page={{ num }}">
                                            {{ num }}
                                        </a>
                                    </li>
                                {% elif num == 2 or num == articles.paginator.num_pages|add:'-1' %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if articles.has_next %}
                                <li class="page-item">
                                    <a class="page-link" 
                                       href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.sort %}sort={{ request.GET.sort }}&{% endif %}page={{ articles.next_page_number }}"
                                       rel="next">
                                        Next <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
                
            {% else %}
                <!-- No Articles Found -->
                <div class="no-articles text-center py-5">
                    <div class="mb-4">
                        <i class="bi bi-newspaper text-muted" style="font-size: 5rem;"></i>
                    </div>
                    
                    <h2 class="h4 mb-3">No Articles Found</h2>
                    
                    {% if request.GET.search or request.GET.category %}
                        <p class="text-muted mb-4">
                            No articles match your current filters. Try adjusting your search criteria or browse all articles.
                        </p>
                        
                        <a href="{% url 'books:news_list' %}" class="btn btn-primary">
                            <i class="bi bi-arrow-clockwise me-2"></i>Show All Articles
                        </a>
                    {% else %}
                        <p class="text-muted mb-4">
                            We haven't published any articles yet. Check back soon for news, reviews, and updates!
                        </p>
                        
                        <a href="{% url 'books:home' %}" class="btn btn-primary">
                            <i class="bi bi-house me-2"></i>Return to Home
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </section>
    </main>
    
    <!-- Sidebar -->
    <aside class="col-lg-4">
        <!-- Newsletter Subscription -->
        <section class="newsletter mb-4" aria-labelledby="newsletter-heading">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <header>
                        <h2 id="newsletter-heading" class="h5 mb-3">
                            <i class="bi bi-envelope-heart me-2"></i>
                            Stay Updated
                        </h2>
                    </header>
                    
                    <p class="small mb-3">
                        Subscribe to our newsletter to get the latest articles delivered to your inbox.
                    </p>
                    
                    <form class="newsletter-form" method="post" action="#" novalidate>
                        <div class="input-group">
                            <input type="email" 
                                   class="form-control" 
                                   placeholder="Your email..."
                                   required
                                   aria-label="Email for newsletter">
                            <button type="submit" class="btn btn-light">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                        <div class="form-text text-white-50 mt-2">
                            <small>We respect your privacy. Unsubscribe at any time.</small>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- Popular Articles -->
        {% if popular_articles %}
            <section class="popular-articles mb-4" aria-labelledby="popular-heading">
                <div class="card">
                    <div class="card-header">
                        <h2 id="popular-heading" class="h6 mb-0">
                            <i class="bi bi-fire text-danger me-2"></i>
                            Popular Articles
                        </h2>
                    </div>
                    <div class="list-group list-group-flush">
                        {% for article in popular_articles %}
                            <article class="list-group-item list-group-item-action">
                                <div class="d-flex align-items-start">
                                    <div class="badge bg-danger me-2 mt-1">{{ forloop.counter }}</div>
                                    
                                    <div class="flex-grow-1">
                                        <h3 class="h6 mb-1">
                                            <a href="{{ article.get_absolute_url }}" 
                                               class="text-decoration-none">
                                                {{ article.title|truncatechars:50 }}
                                            </a>
                                        </h3>
                                        
                                        <div class="small text-muted">
                                            <time datetime="{{ article.published_at|date:'c' }}">
                                                {{ article.published_at|date:"M j" }}
                                            </time>
                                            • {{ article.view_count|default:0 }} views
                                        </div>
                                    </div>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
        {% endif %}
        
        <!-- Article Categories -->
        <section class="categories mb-4" aria-labelledby="categories-heading">
            <div class="card">
                <div class="card-header">
                    <h2 id="categories-heading" class="h6 mb-0">
                        <i class="bi bi-tags text-success me-2"></i>
                        Article Categories
                    </h2>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'books:news_list' %}" 
                       class="list-group-item list-group-item-action {% if not request.GET.category %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>All Articles</span>
                            <span class="badge bg-primary">{{ total_articles }}</span>
                        </div>
                    </a>
                    
                    <a href="?category=news" 
                       class="list-group-item list-group-item-action {% if request.GET.category == 'news' %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-megaphone me-2"></i>Company News</span>
                            <span class="badge bg-secondary">{{ category_counts.news|default:0 }}</span>
                        </div>
                    </a>
                    
                    <a href="?category=reviews" 
                       class="list-group-item list-group-item-action {% if request.GET.category == 'reviews' %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-star me-2"></i>Book Reviews</span>
                            <span class="badge bg-secondary">{{ category_counts.reviews|default:0 }}</span>
                        </div>
                    </a>
                    
                    <a href="?category=interviews" 
                       class="list-group-item list-group-item-action {% if request.GET.category == 'interviews' %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-mic me-2"></i>Author Interviews</span>
                            <span class="badge bg-secondary">{{ category_counts.interviews|default:0 }}</span>
                        </div>
                    </a>
                    
                    <a href="?category=events" 
                       class="list-group-item list-group-item-action {% if request.GET.category == 'events' %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-calendar-event me-2"></i>Literary Events</span>
                            <span class="badge bg-secondary">{{ category_counts.events|default:0 }}</span>
                        </div>
                    </a>
                    
                    <a href="?category=tips" 
                       class="list-group-item list-group-item-action {% if request.GET.category == 'tips' %}active{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-lightbulb me-2"></i>Reading Tips</span>
                            <span class="badge bg-secondary">{{ category_counts.tips|default:0 }}</span>
                        </div>
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Archive -->
        {% if archive_data %}
            <section class="archive mb-4" aria-labelledby="archive-heading">
                <div class="card">
                    <div class="card-header">
                        <h2 id="archive-heading" class="h6 mb-0">
                            <i class="bi bi-archive text-info me-2"></i>
                            Article Archive
                        </h2>
                    </div>
                    <div class="list-group list-group-flush">
                        {% for month_data in archive_data %}
                            <a href="?year={{ month_data.year }}&month={{ month_data.month }}" 
                               class="list-group-item list-group-item-action">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>
                                        {{ month_data.month_name }} {{ month_data.year }}
                                    </span>
                                    <span class="badge bg-secondary">{{ month_data.count }}</span>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </section>
        {% endif %}
        
        <!-- RSS Feed -->
        <section class="rss-feed" aria-labelledby="rss-heading">
            <div class="card">
                <div class="card-body text-center">
                    <h2 id="rss-heading" class="h6 mb-3">
                        <i class="bi bi-rss text-warning me-2"></i>
                        Stay Connected
                    </h2>
                    
                    <p class="small text-muted mb-3">
                        Follow our articles via RSS or social media
                    </p>
                    
                    <div class="d-flex justify-content-center gap-2">
                        <a href="/rss/" class="btn btn-sm btn-outline-warning" title="RSS Feed">
                            <i class="bi bi-rss"></i> RSS
                        </a>
                        
                        <a href="#" class="btn btn-sm btn-outline-primary" title="Facebook">
                            <i class="bi bi-facebook"></i>
                        </a>
                        
                        <a href="#" class="btn btn-sm btn-outline-info" title="Twitter">
                            <i class="bi bi-twitter"></i>
                        </a>
                        
                        <a href="#" class="btn btn-sm btn-outline-success" title="Telegram">
                            <i class="bi bi-telegram"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </aside>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-submit form on filter changes
    const filterForm = document.querySelector('.filter-section form');
    const categorySelect = document.getElementById('category');
    const sortSelect = document.getElementById('sort');
    
    if (categorySelect && sortSelect) {
        [categorySelect, sortSelect].forEach(select => {
            select.addEventListener('change', function() {
                filterForm.submit();
            });
        });
    }
    
    // Share functionality
    const shareButtons = document.querySelectorAll('.share-btn');
    shareButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const url = this.dataset.url;
            const title = this.dataset.title;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                }).catch(error => console.log('Error sharing:', error));
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(url).then(() => {
                    // Show temporary feedback
                    const originalHtml = this.innerHTML;
                    this.innerHTML = '<i class="bi bi-check"></i>';
                    this.classList.add('btn-success');
                    
                    setTimeout(() => {
                        this.innerHTML = originalHtml;
                        this.classList.remove('btn-success');
                    }, 2000);
                });
            }
        });
    });
    
    // Bookmark functionality
    const bookmarkButtons = document.querySelectorAll('.bookmark-btn');
    bookmarkButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const articleId = this.dataset.articleId;
            const isBookmarked = this.classList.contains('bookmarked');
            
            // Toggle bookmark state
            fetch('/api/bookmarks/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: JSON.stringify({
                    'article_id': articleId,
                    'action': isBookmarked ? 'remove' : 'add'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.bookmarked) {
                        this.innerHTML = '<i class="bi bi-bookmark-fill"></i>';
                        this.classList.add('bookmarked');
                        this.title = 'Remove bookmark';
                    } else {
                        this.innerHTML = '<i class="bi bi-bookmark"></i>';
                        this.classList.remove('bookmarked');
                        this.title = 'Bookmark this article';
                    }
                }
            })
            .catch(error => console.error('Bookmark error:', error));
        });
    });
    
    // Newsletter subscription
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const emailInput = this.querySelector('input[type="email"]');
            const submitBtn = this.querySelector('button[type="submit"]');
            
            if (emailInput.checkValidity()) {
                const originalHtml = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i>';
                submitBtn.disabled = true;
                
                // Simulate subscription (replace with actual API call)
                setTimeout(() => {
                    submitBtn.innerHTML = '<i class="bi bi-check"></i>';
                    emailInput.value = '';
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'alert alert-success mt-2';
                    successDiv.innerHTML = '<small>Thank you for subscribing!</small>';
                    this.appendChild(successDiv);
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = originalHtml;
                        submitBtn.disabled = false;
                        successDiv.remove();
                    }, 3000);
                }, 1000);
            } else {
                emailInput.reportValidity();
            }
        });
    }
    
    // Lazy loading for images (if Intersection Observer is supported)
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                }
            });
        });
        
        // Observe all lazy images
        document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }
    
    // Reading progress indicator (for long articles)
    function updateReadingProgress() {
        const articles = document.querySelectorAll('.article-card');
        const windowHeight = window.innerHeight;
        const scrollTop = window.scrollY;
        
        articles.forEach(article => {
            const rect = article.getBoundingClientRect();
            const articleTop = rect.top + scrollTop;
            const articleHeight = rect.height;
            
            if (scrollTop > articleTop && scrollTop < articleTop + articleHeight) {
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop - articleTop) / articleHeight) * 100
                ));
                
                // Update progress if element exists
                const progressBar = article.querySelector('.reading-progress');
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
            }
        });
    }
    
    // Throttled scroll handler
    let scrollTimeout;
    window.addEventListener('scroll', function() {
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }
        scrollTimeout = setTimeout(updateReadingProgress, 100);
    });
});

// Print functionality for articles
function printArticle(articleId) {
    const article = document.querySelector(`[data-article-id="${articleId}"]`);
    if (article) {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>HeavyShop Article</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; }
                    img { max-width: 100%; height: auto; }
                    .no-print { display: none; }
                </style>
            </head>
            <body>
                ${article.innerHTML}
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }
}
</script>

<!-- Enhanced styles for better visual presentation -->
<style>
.article-card {
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.article-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

.article-image-container {
    overflow: hidden;
    margin: 0;
}

.article-image-container img {
    transition: transform 0.3s ease;
}

.article-card:hover .article-image-container img {
    transform: scale(1.05);
}

.stretched-link {
    position: static;
}

.stretched-link::after {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 1;
    content: "";
}

.share-btn, .bookmark-btn {
    position: relative;
    z-index: 2;
}

.category-filters .nav-link {
    color: #6c757d;
    transition: all 0.2s ease;
}

.category-filters .nav-link:hover,
.category-filters .nav-link.active {
    color: #0d6efd;
    background-color: #e7f1ff;
}

@media (max-width: 768px) {
    .article-card .row {
        flex-direction: column;
    }
    
    .article-image-container {
        height: 200px;
    }
}

/* Print styles */
@media print {
    .filter-section,
    .pagination,
    .share-btn,
    .bookmark-btn,
    .sidebar {
        display: none !important;
    }
    
    .article-card {
        break-inside: avoid;
        page-break-inside: avoid;
    }
}
</style>

{% endblock %}