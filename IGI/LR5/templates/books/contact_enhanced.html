{% extends 'base_enhanced.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Contact Us - HeavyShop{% endblock %}

{% block meta_description %}
Get in touch with HeavyShop. Find our contact information, location, business hours, and send us a message. We're here to help with all your book-related needs.
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ContactPage",
    "mainEntity": {
        "@type": "Organization",
        "name": "HeavyShop",
        "contactPoint": [
            {
                "@type": "ContactPoint",
                "telephone": "+375-29-123-45-67",
                "contactType": "customer service",
                "availableLanguage": ["English", "Russian", "Belarusian"]
            },
            {
                "@type": "ContactPoint",
                "email": "support@heavyshop.by",
                "contactType": "customer support"
            }
        ],
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "123 Independence Ave",
            "addressLocality": "Minsk",
            "postalCode": "220004",
            "addressCountry": "BY"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 53.9006,
            "longitude": 27.5590
        },
        "openingHours": "Mo-Fr 09:00-18:00, Sa 10:00-16:00"
    }
}
</script>
{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<nav aria-label="Breadcrumb">
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'books:home' %}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Contact Us</li>
    </ol>
</nav>

<div class="row">
    <!-- Main Contact Form -->
    <div class="col-lg-8">
        <section aria-labelledby="contact-heading">
            <header class="mb-4">
                <h1 id="contact-heading" class="display-6 mb-3">
                    <i class="bi bi-envelope text-primary"></i>
                    Contact Us
                </h1>
                <p class="lead">
                    We'd love to hear from you! Whether you have questions about our books, 
                    need help with an order, or just want to say hello, we're here to help.
                </p>
            </header>
            
            <!-- Contact Form -->
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0">
                        <i class="bi bi-chat-dots me-2"></i>
                        Send us a Message
                    </h2>
                </div>
                <div class="card-body">
                    <form method="post" class="contact-form" novalidate>
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_name" class="form-label required">
                                        <i class="bi bi-person me-1"></i>Full Name
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="id_name" 
                                           name="name"
                                           required
                                           minlength="2"
                                           maxlength="100"
                                           placeholder="Enter your full name"
                                           autocomplete="name">
                                    <div class="invalid-feedback">
                                        Please provide your full name (at least 2 characters).
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_email" class="form-label required">
                                        <i class="bi bi-envelope me-1"></i>Email Address
                                    </label>
                                    <input type="email" 
                                           class="form-control" 
                                           id="id_email" 
                                           name="email"
                                           required
                                           placeholder="your.email@example.com"
                                           autocomplete="email">
                                    <div class="invalid-feedback">
                                        Please provide a valid email address.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_phone" class="form-label">
                                        <i class="bi bi-telephone me-1"></i>Phone Number
                                    </label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="id_phone" 
                                           name="phone"
                                           pattern="[+]?[0-9\s\-\(\)]+"
                                           placeholder="+375 29 123 45 67"
                                           autocomplete="tel">
                                    <div class="form-text">
                                        Optional. Include country code if calling internationally.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="id_subject" class="form-label required">
                                        <i class="bi bi-tag me-1"></i>Subject
                                    </label>
                                    <select class="form-select" id="id_subject" name="subject" required>
                                        <option value="">Select a subject...</option>
                                        <option value="order">Order Inquiry</option>
                                        <option value="book_request">Book Request</option>
                                        <option value="support">Technical Support</option>
                                        <option value="feedback">Feedback</option>
                                        <option value="partnership">Partnership</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select a subject for your message.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_order_number" class="form-label">
                                <i class="bi bi-receipt me-1"></i>Order Number
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="id_order_number" 
                                   name="order_number"
                                   pattern="[0-9A-Za-z\-]+"
                                   placeholder="e.g., ORD-123456"
                                   maxlength="20">
                            <div class="form-text">
                                If your inquiry is related to a specific order, please include the order number.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_message" class="form-label required">
                                <i class="bi bi-chat-text me-1"></i>Message
                            </label>
                            <textarea class="form-control" 
                                      id="id_message" 
                                      name="message" 
                                      rows="6"
                                      required
                                      minlength="10"
                                      maxlength="2000"
                                      placeholder="Please describe your inquiry or message in detail..."></textarea>
                            <div class="form-text">
                                <span id="char-count">0</span>/2000 characters
                            </div>
                            <div class="invalid-feedback">
                                Please provide a message with at least 10 characters.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       id="id_newsletter" 
                                       name="newsletter">
                                <label class="form-check-label" for="id_newsletter">
                                    Subscribe to our newsletter for updates and promotions
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       id="id_privacy" 
                                       name="privacy_agreement"
                                       required>
                                <label class="form-check-label required" for="id_privacy">
                                    I agree to the <a href="{% url 'books:privacy_policy' %}" target="_blank">Privacy Policy</a>
                                    and consent to the processing of my personal data
                                </label>
                                <div class="invalid-feedback">
                                    You must agree to the privacy policy to submit the form.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Honeypot field for spam protection -->
                        <div style="position: absolute; left: -9999px;">
                            <input type="text" name="honeypot" tabindex="-1" autocomplete="off">
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="reset" class="btn btn-outline-secondary me-md-2">
                                <i class="bi bi-arrow-clockwise me-1"></i>Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-send me-1"></i>Send Message
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- FAQ Section -->
            <section class="faq-section mt-5" aria-labelledby="faq-heading">
                <header>
                    <h2 id="faq-heading" class="h3 mb-4">
                        <i class="bi bi-question-circle text-info"></i>
                        Frequently Asked Questions
                    </h2>
                </header>
                
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" 
                                    type="button" 
                                    data-bs-toggle="collapse" 
                                    data-bs-target="#faq1"
                                    aria-expanded="false" 
                                    aria-controls="faq1">
                                How long does delivery take?
                            </button>
                        </h3>
                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Standard delivery within Minsk takes 1-2 business days. 
                                For other cities in Belarus, delivery typically takes 3-5 business days. 
                                Express delivery options are available for faster service.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" 
                                    type="button" 
                                    data-bs-toggle="collapse" 
                                    data-bs-target="#faq2"
                                    aria-expanded="false" 
                                    aria-controls="faq2">
                                Can I return a book if I don't like it?
                            </button>
                        </h3>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Yes! We offer a 14-day return policy for books in original condition. 
                                The book should be undamaged and in sellable condition. 
                                Return shipping costs may apply depending on the reason for return.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" 
                                    type="button" 
                                    data-bs-toggle="collapse" 
                                    data-bs-target="#faq3"
                                    aria-expanded="false" 
                                    aria-controls="faq3">
                                Do you offer international shipping?
                            </button>
                        </h3>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Currently, we ship within Belarus only. However, we're working on expanding our 
                                shipping options to neighboring countries. 
                                Subscribe to our newsletter to be notified when international shipping becomes available.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </div>
    
    <!-- Contact Information Sidebar -->
    <aside class="col-lg-4">
        <!-- Contact Details -->
        <section class="contact-info mb-4" aria-labelledby="contact-info-heading">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h2 id="contact-info-heading" class="h5 mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        Contact Information
                    </h2>
                </div>
                <div class="card-body">
                    <address class="mb-4" itemscope itemtype="http://schema.org/PostalAddress">
                        <h3 class="h6 text-primary mb-2">
                            <i class="bi bi-geo-alt me-1"></i>Our Address
                        </h3>
                        <span itemprop="streetAddress">123 Independence Ave</span><br>
                        <span itemprop="addressLocality">Minsk</span>, 
                        <span itemprop="postalCode">220004</span><br>
                        <span itemprop="addressCountry">Belarus</span>
                    </address>
                    
                    <div class="contact-methods">
                        <div class="mb-3">
                            <h3 class="h6 text-primary mb-2">
                                <i class="bi bi-telephone me-1"></i>Phone Numbers
                            </h3>
                            <p class="mb-1">
                                <strong>Main:</strong> 
                                <a href="tel:+375291234567" class="text-decoration-none">
                                    +375 29 123-45-67
                                </a>
                            </p>
                            <p class="mb-1">
                                <strong>Support:</strong> 
                                <a href="tel:+375291234568" class="text-decoration-none">
                                    +375 29 123-45-68
                                </a>
                            </p>
                            <p class="small text-muted">Available in Russian, Belarusian, and English</p>
                        </div>
                        
                        <div class="mb-3">
                            <h3 class="h6 text-primary mb-2">
                                <i class="bi bi-envelope me-1"></i>Email Addresses
                            </h3>
                            <p class="mb-1">
                                <strong>General:</strong> 
                                <a href="mailto:info@heavyshop.by" class="text-decoration-none">
                                    info@heavyshop.by
                                </a>
                            </p>
                            <p class="mb-1">
                                <strong>Support:</strong> 
                                <a href="mailto:support@heavyshop.by" class="text-decoration-none">
                                    support@heavyshop.by
                                </a>
                            </p>
                            <p class="mb-1">
                                <strong>Orders:</strong> 
                                <a href="mailto:orders@heavyshop.by" class="text-decoration-none">
                                    orders@heavyshop.by
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Business Hours -->
        <section class="business-hours mb-4" aria-labelledby="hours-heading">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h2 id="hours-heading" class="h5 mb-0">
                        <i class="bi bi-clock me-2"></i>
                        Business Hours
                    </h2>
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0" summary="Store operating hours for each day of the week">
                        <caption class="visually-hidden">HeavyShop business hours by day</caption>
                        <thead class="visually-hidden">
                            <tr>
                                <th scope="col">Day</th>
                                <th scope="col">Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">Monday - Friday</th>
                                <td>
                                    <time datetime="09:00">9:00 AM</time> - 
                                    <time datetime="18:00">6:00 PM</time>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">Saturday</th>
                                <td>
                                    <time datetime="10:00">10:00 AM</time> - 
                                    <time datetime="16:00">4:00 PM</time>
                                </td>
                            </tr>
                            <tr class="text-muted">
                                <th scope="row">Sunday</th>
                                <td>Closed</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="mt-3 p-2 bg-light rounded">
                        <p class="small mb-0">
                            <i class="bi bi-info-circle text-info me-1"></i>
                            <strong>Current time:</strong> 
                            <time id="current-time" datetime="{{ current_time|date:'c' }}">
                                {{ current_time|date:"l, F j, Y - g:i A" }}
                            </time>
                        </p>
                        <p class="small mb-0 status-indicator" id="store-status">
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle me-1"></i>Currently Open
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Map Section -->
        <section class="map-section mb-4" aria-labelledby="map-heading">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h2 id="map-heading" class="h5 mb-0">
                        <i class="bi bi-map me-2"></i>
                        Find Us
                    </h2>
                </div>
                <div class="card-body p-0">
                    <!-- Embedded Map -->
                    <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=27.5490%2C53.8906%2C27.5690%2C53.9106&amp;layer=mapnik&amp;marker=53.9006%2C27.5590"
                            width="100%" 
                            height="250"
                            frameborder="0"
                            title="HeavyShop Location Map"
                            aria-describedby="map-description">
                    </iframe>
                    <div id="map-description" class="visually-hidden">
                        Interactive map showing HeavyShop location at 123 Independence Ave, Minsk, Belarus
                    </div>
                    
                    <div class="p-3">
                        <p class="small mb-2">
                            <i class="bi bi-geo-alt text-danger me-1"></i>
                            We're located in the heart of Minsk, easily accessible by public transport.
                        </p>
                        <a href="https://www.google.com/maps/search/123+Independence+Ave,+Minsk,+Belarus" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-arrow-up-right-square me-1"></i>
                            Open in Maps
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Social Media -->
        <section class="social-media" aria-labelledby="social-heading">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 id="social-heading" class="h5 mb-0">
                        <i class="bi bi-share me-2"></i>
                        Follow Us
                    </h2>
                </div>
                <div class="card-body text-center">
                    <div class="d-flex justify-content-center gap-3">
                        <a href="#" 
                           class="btn btn-outline-primary rounded-circle social-btn"
                           title="Follow us on Facebook"
                           aria-label="Facebook">
                            <i class="bi bi-facebook"></i>
                        </a>
                        <a href="#" 
                           class="btn btn-outline-info rounded-circle social-btn"
                           title="Follow us on Twitter"
                           aria-label="Twitter">
                            <i class="bi bi-twitter"></i>
                        </a>
                        <a href="#" 
                           class="btn btn-outline-danger rounded-circle social-btn"
                           title="Follow us on Instagram"
                           aria-label="Instagram">
                            <i class="bi bi-instagram"></i>
                        </a>
                        <a href="#" 
                           class="btn btn-outline-success rounded-circle social-btn"
                           title="Chat with us on Telegram"
                           aria-label="Telegram">
                            <i class="bi bi-telegram"></i>
                        </a>
                    </div>
                    <p class="small text-muted mt-2 mb-0">
                        Stay updated with our latest news and offers
                    </p>
                </div>
            </div>
        </section>
    </aside>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const contactForm = document.querySelector('.contact-form');
    const messageTextarea = document.getElementById('id_message');
    const charCount = document.getElementById('char-count');
    
    // Character counter for message textarea
    if (messageTextarea && charCount) {
        messageTextarea.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            if (count > 2000) {
                charCount.classList.add('text-danger');
            } else if (count > 1800) {
                charCount.classList.add('text-warning');
                charCount.classList.remove('text-danger');
            } else {
                charCount.classList.remove('text-danger', 'text-warning');
            }
        });
    }
    
    // Form submission with validation
    if (contactForm) {
        contactForm.addEventListener('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();
            
            // Custom validation
            let isValid = true;
            const formData = new FormData(this);
            
            // Check honeypot
            if (formData.get('honeypot')) {
                console.log('Spam detected');
                return false;
            }
            
            // Validate required fields
            const requiredFields = ['name', 'email', 'subject', 'message', 'privacy_agreement'];
            requiredFields.forEach(fieldName => {
                const field = this.querySelector(`[name="${fieldName}"]`);
                if (field) {
                    if (field.type === 'checkbox') {
                        if (!field.checked) {
                            field.setCustomValidity('This field is required');
                            isValid = false;
                        } else {
                            field.setCustomValidity('');
                        }
                    } else if (!field.value.trim()) {
                        field.setCustomValidity('This field is required');
                        isValid = false;
                    } else {
                        field.setCustomValidity('');
                    }
                }
            });
            
            // Email validation
            const emailField = this.querySelector('[name="email"]');
            if (emailField && emailField.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailField.value)) {
                    emailField.setCustomValidity('Please enter a valid email address');
                    isValid = false;
                } else {
                    emailField.setCustomValidity('');
                }
            }
            
            // Phone validation (if provided)
            const phoneField = this.querySelector('[name="phone"]');
            if (phoneField && phoneField.value) {
                const phoneRegex = /^[+]?[0-9\s\-\(\)]+$/;
                if (!phoneRegex.test(phoneField.value)) {
                    phoneField.setCustomValidity('Please enter a valid phone number');
                    isValid = false;
                } else {
                    phoneField.setCustomValidity('');
                }
            }
            
            // Message length validation
            const messageField = this.querySelector('[name="message"]');
            if (messageField) {
                if (messageField.value.length < 10) {
                    messageField.setCustomValidity('Message must be at least 10 characters long');
                    isValid = false;
                } else if (messageField.value.length > 2000) {
                    messageField.setCustomValidity('Message must not exceed 2000 characters');
                    isValid = false;
                } else {
                    messageField.setCustomValidity('');
                }
            }
            
            this.classList.add('was-validated');
            
            if (isValid && this.checkValidity()) {
                // Simulate form submission
                const submitButton = this.querySelector('button[type="submit"]');
                const originalText = submitButton.innerHTML;
                
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Sending...';
                
                // Simulate API call
                setTimeout(() => {
                    // Show success message
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-success alert-dismissible fade show mt-3';
                    alertDiv.innerHTML = `
                        <i class="bi bi-check-circle me-2"></i>
                        <strong>Thank you!</strong> Your message has been sent successfully. 
                        We'll get back to you within 24 hours.
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    
                    this.insertAdjacentElement('beforebegin', alertDiv);
                    
                    // Reset form
                    this.reset();
                    this.classList.remove('was-validated');
                    charCount.textContent = '0';
                    
                    // Reset button
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                    
                    // Scroll to success message
                    alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                }, 1500);
            }
        });
    }
    
    // Update current time every minute
    function updateCurrentTime() {
        const timeElement = document.getElementById('current-time');
        const statusElement = document.getElementById('store-status');
        
        if (timeElement && statusElement) {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            };
            
            timeElement.textContent = now.toLocaleDateString('en-US', options);
            timeElement.setAttribute('datetime', now.toISOString());
            
            // Check if store is open
            const hour = now.getHours();
            const day = now.getDay();
            let isOpen = false;
            
            if (day >= 1 && day <= 5) { // Monday-Friday
                isOpen = hour >= 9 && hour < 18;
            } else if (day === 6) { // Saturday
                isOpen = hour >= 10 && hour < 16;
            }
            
            if (isOpen) {
                statusElement.innerHTML = `
                    <span class="badge bg-success">
                        <i class="bi bi-check-circle me-1"></i>Currently Open
                    </span>
                `;
            } else {
                statusElement.innerHTML = `
                    <span class="badge bg-danger">
                        <i class="bi bi-x-circle me-1"></i>Currently Closed
                    </span>
                `;
            }
        }
    }
    
    // Update time immediately and then every minute
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);
    
    // Social media buttons hover effects
    const socialButtons = document.querySelectorAll('.social-btn');
    socialButtons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1)';
        });
        
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
.social-btn {
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.social-btn:hover {
    transform: scale(1.1);
}

.required::after {
    content: ' *';
    color: #dc3545;
}

.form-control:invalid {
    border-color: #dc3545;
}

.form-control:valid {
    border-color: #198754;
}

.was-validated .form-control:invalid {
    border-color: #dc3545;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
}

.was-validated .form-control:valid {
    border-color: #198754;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='m2.3 6.73l.4.31 1.4-1.4 2.1-2.1-.7-.7-1.4 1.4-.7-.7-.7.7z'/%3e%3c/svg%3e");
}
</style>

{% endblock %}